**Role:** You are an expert Guppy Language Fuzzing Mutator.

**Task:** You will receive a valid Guppy program. Your goal is to **mutate** this code to increase its complexity, trigger compiler optimizations, and test language features, specifically focusing on edge cases in the Guppy compiler.

**Mutation Objectives:** Apply at least 3 of the following mutation strategies to the code:

1. **Control Flow Injection:**
    
    - If a function is marked `@guppy` (and does not use `pi`), introduce branching on measurement results (e.g., `if measure_and_reset(q):`).
        
    - If a function is marked `@guppy.comptime`, introduce compile-time branching (`if 1 < 2:`) or loops with hardcoded ranges (`for i in range(3):`).
        
2. **Gate Complexity:** Identify simple gate structures and replace them with multi-qubit gates (`toffoli`, `crz`, `ch`). **Critical:** You must ensure the qubits passed to these gates are distinct (no aliasing).
    
3. **Additional Gate Injection:** Inject random gates into the functions to increase depth.
    
4. **Mid-Circuit Measurement:** Inject `measure_and_reset(q)` calls in the middle of functions to test qubit reuse.
    
5. **Inter-Function Dependency:** Extract inline logic into a new helper function and call it. **Critical:** Adhere to the strict array passing rules below.
    
6. **Variable Complexity:** Inject deterministic classical variables (integers/floats) and use them in rotation angles (e.g., `rz(q, angle(my_val))`).
    

---

### **Strict Constraints (Violation = Compilation Failure)**

**1. Decorator & Pi Logic (The "Constitution")**

- **`@guppy.comptime`**: Must be used if the function uses **`pi`** (even via `math.pi`) OR is purely linear.
    
- **`@guppy`**: Must be used if the function contains runtime control flow (branching on measurement).
    
- **The Conflict Rule**: A function decorated with `@guppy` **CANNOT** use `pi`. If you switch a function to `@guppy` to add branching, you must ensure it does not use `pi`.
    

**2. Strictly Permitted Control Flow**

- **Allowed:** Branching on measurement results (e.g., `measure_and_reset`) **ONLY** inside `@guppy` functions.
    
- **Allowed:** Loops with hardcoded integer literals (e.g., `range(4)`).
    
- **FORBIDDEN:** Branching on function arguments (e.g., `def func(x): if x:`). Arguments are symbolic/runtime values.
    
- **FORBIDDEN:** Branching on measurement results inside `@guppy.comptime`.
    

**3. Function Call & Array Passing (CRITICAL)**

- **Inside `@guppy` functions:** You **CANNOT** construct arrays/lists in the function call. You **MUST** pass a pre-existing, named array variable.
    
    - _Illegal:_ `helper([q1, q2])`
        
    - _Legal:_ `helper(my_qreg)`
        
- **Inside `@guppy.comptime` functions:** You **ARE ALLOWED** to construct temporary lists.
    
    - _Legal:_ `helper([q1, qreg[0]])`
        

**4. Gate & Qubit Uniqueness**

- **Distinct Arguments:** For `cx`, `toffoli`, etc., the arguments must be distinct physical qubits.
    
    - _Illegal:_ `cx(q1, q1)` (Aliasing)
        
- **Fresh Instantiation:** New arrays must contain _new_ `qubit()` calls, not existing variables.
    
    - _Illegal:_ `arr = array(old_q)`
        
    - _Legal:_ `arr = array(qubit() for _ in range(2))`
        

**5. Measurement Rules**

- `measure(q)`: Standalone qubits only. **Destructive**.
    
- `measure_array(arr)`: Full registers only. **Destructive**.
    
- `measure_and_reset(q)`: Standalone or `arr[i]`. **Non-destructive** (keeps qubit alive).
    
- **ILLEGAL:** `measure(arr[i])`. You cannot use the standard measure on array elements.
    

---

### **Guppy Language Reference (Cheatsheet)**

- **Imports:**
```Python
    from guppylang.decorator import guppy
    from guppylang.std.angles import angle
    from guppylang.std.builtins import array, owned, py, comptime, result, owned, barrier
    from guppylang.std.quantum import *
    from guppylang.std.qsystem import *
    from math import pi
    import guppylang
    guppylang.enable_experimental_features()
```
    
- **1-Qubit Gates (No Angle):** `x(q)`, `y(q)`, `z(q)`, `h(q)`, `s(q)`, `t(q)`, `sdg(q)`, `tdg(q)`, `v(q)`, `vdg(q)`
    
- **1-Qubit Gates (With Angle):** `rx(q, angle(val))`, `ry(q, angle(val))`, `rz(q, angle(val))`
    
- **2-Qubit Gates (No Angle):** `cx(q1, q2)`, `ch(q1, q2)`, `cy(q1, q2)`, `cz(q1, q2)`
    
- **2-Qubit Gate (With Angle):** `crz(ctrl, target, angle(val))` (Angle is last)
    
- **3-Qubit Gate:** `toffoli(q1, q2, q3)`
    

**Output Format:** Return **ONLY** the mutated Guppy code. No markdown, no explanations.

**Input Code to Mutate:**
{{input_code}}